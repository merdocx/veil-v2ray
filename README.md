# VPN Server —Å VLESS+Reality

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π VPN —Å–µ—Ä–≤–µ—Ä –Ω–∞ –±–∞–∑–µ Xray-core —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º VLESS+Reality –∏ API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Xray-core** - –æ—Å–Ω–æ–≤–Ω–æ–π VPN —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π VLESS+Reality
- **FastAPI** - REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏
- **Nginx** - –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è API
- **Systemd** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/root/vpn-server/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ config.json          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray
‚îÇ   ‚îú‚îÄ‚îÄ keys.env             # –ö–ª—é—á–∏ Reality
‚îÇ   ‚îî‚îÄ‚îÄ keys.json            # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ logs/                    # –õ–æ–≥–∏ Xray
‚îú‚îÄ‚îÄ venv/                    # Python –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ api.py                   # –û—Å–Ω–æ–≤–Ω–æ–π API —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ generate_keys.sh         # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ generate_client_config.py # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ README.md               # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## API Endpoints

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞
```bash
POST /api/keys
Content-Type: application/json
X-API-Key: YOUR_API_KEY

{
    "name": "–ò–º—è –∫–ª—é—á–∞"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª—é—á–µ–π
```bash
GET /api/keys
X-API-Key: YOUR_API_KEY
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–µ
```bash
GET /api/keys/{key_id}
X-API-Key: YOUR_API_KEY
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
```bash
GET /api/keys/{key_id}/config
X-API-Key: YOUR_API_KEY
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–∞
```bash
DELETE /api/keys/{key_id}
X-API-Key: YOUR_API_KEY
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π
```bash
GET /api/traffic/simple
X-API-Key: YOUR_API_KEY
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
```bash
GET /api/keys/{key_id}/traffic/simple
X-API-Key: YOUR_API_KEY
```

#### –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–ª—é—á–∞
```bash
POST /api/keys/{key_id}/traffic/simple/reset
X-API-Key: YOUR_API_KEY
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ endpoints

#### –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
```bash
GET /api/system/ports
X-API-Key: YOUR_API_KEY
```

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray
```bash
POST /api/system/xray/sync-config
X-API-Key: YOUR_API_KEY
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `https://veil-bird.ru/docs`

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
systemctl status xray vpn-api nginx
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
systemctl restart xray
systemctl restart vpn-api
systemctl reload nginx
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
journalctl -u xray -f
journalctl -u vpn-api -f
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: VLESS
- **–°–µ—Ä–≤–µ—Ä**: veil-bird.ru
- **–ü–æ—Ä—Ç**: 443
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Reality
- **SNI**: www.microsoft.com
- **Fingerprint**: Chrome

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ API endpoint `/api/keys/{key_id}/config`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ SSL
- **API –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–¥–µ
- **Reality –ø—Ä–æ—Ç–æ–∫–æ–ª** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–±—Ñ—É—Å–∫–∞—Ü–∏—é —Ç—Ä–∞—Ñ–∏–∫–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π** —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
- **Security headers** –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –∞—Ç–∞–∫
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –Ω–∞ –≤—Å–µ —Ñ–∞–π–ª—ã

### üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–æ–º
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ API –∫–ª—é—á–∞
python3 /root/vpn-server/generate_api_key.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
python3 /root/vpn-server/security_check.py
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
–õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤:
- Xray: `/root/vpn-server/logs/`
- API: `journalctl -u vpn-api`
- Nginx: `/var/log/nginx/`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞
–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–º —Ç—Ä–∞—Ñ–∏–∫–µ:

#### –ú–µ—Ç–æ–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–ü—Ä–æ—Å—Ç–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (`/api/traffic/simple`) - –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø–æ–¥—Å—á–µ—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ –æ—Ü–µ–Ω–∫–µ —Ç—Ä–∞—Ñ–∏–∫–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**: ESTAB, LAST-ACK, CLOSE-WAIT
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π
curl -k -X GET "https://veil-bird.ru/api/traffic/simple" \
  -H "X-API-Key: YOUR_API_KEY"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
curl -k -X GET "https://veil-bird.ru/api/keys/{key_id}/traffic/simple" \
  -H "X-API-Key: YOUR_API_KEY"

# –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
curl -k -X POST "https://veil-bird.ru/api/keys/{key_id}/traffic/simple/reset" \
  -H "X-API-Key: YOUR_API_KEY"
```

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
```json
{
  "status": "success",
  "key": {...},
  "traffic": {
    "port": 10001,
    "connections": 111,
    "total_bytes": 33323549,
    "rx_bytes": 16661774,
    "tx_bytes": 16661774,
    "total_formatted": "31.78 MB",
    "rx_formatted": "15.89 MB",
    "tx_formatted": "15.89 MB",
    "traffic_rate": 134128.74,
    "connection_details": [...],
    "timestamp": 1754307423.1131258,
    "source": "simple_monitor",
    "method": "connection_based_estimation"
  }
}
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Xray:
```bash
cd /usr/local/bin
wget -O xray.zip https://github.com/XTLS/Xray-core/releases/download/latest/Xray-linux-64.zip
unzip -o xray.zip
chmod +x xray
systemctl restart xray
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `systemctl status xray vpn-api nginx`
2. –õ–æ–≥–∏: `journalctl -u xray -f`
3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `/root/vpn-server/config/config.json`
4. –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã: `netstat -tlnp | grep :443` 