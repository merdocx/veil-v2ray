# ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–î–∞—Ç–∞:** 2025-11-01  
**–í—Ä–µ–º—è:** 16:44 UTC

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Policy –≤ Xray
**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (`connIdle: 300`)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã (`handshake: 4`)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –±—É—Ñ–µ—Ä—ã (`bufferSize: 0`)
- –û—Ç–∫–ª—é—á–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```json
"policy": {
  "levels": {
    "0": {
      "statsUserUplink": true,
      "statsUserDownlink": true,
      "connIdle": 300,
      "downlinkOnly": 1,
      "handshake": 4,
      "uplinkOnly": 1,
      "bufferSize": 0
    }
  },
  "system": {
    "statsInboundUplink": false,
    "statsInboundDownlink": false,
    "statsOutboundUplink": false,
    "statsOutboundDownlink": false
  }
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (idle –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –õ—É—á—à–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
- ‚úÖ –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å (–º–µ–Ω—å—à–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)

---

### ‚úÖ 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ TCP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è NAT –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π
- –£–ª—É—á—à–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç SYN flood
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ connection tracking

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã sysctl:**
```
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_timestamps = 1
net.ipv4.tcp_sack = 1
net.ipv4.tcp_window_scaling = 1
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_syn_retries = 5
net.ipv4.tcp_ecn = 2
net.ipv4.tcp_fack = 1
net.ipv4.tcp_no_metrics_save = 1

# Connection tracking
net.netfilter.nf_conntrack_tcp_timeout_syn_sent = 60
net.netfilter.nf_conntrack_tcp_timeout_syn_recv = 60
net.netfilter.nf_conntrack_tcp_timeout_established = 7200
net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120
net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60
net.netfilter.nf_conntrack_tcp_timeout_last_ack = 30
net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–æ–≤
- ‚úÖ –ú–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º —Å NAT –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SYN flood –∞—Ç–∞–∫

---

### ‚úÖ 3. Systemd hardening
**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ CPU
- –í–∫–ª—é—á–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ xray.service:**
```ini
MemoryMax=512M
CPUQuota=80%

# Security hardening
NoNewPrivileges=true
PrivateTmp=yes
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectControlGroups=yes
RestrictRealtime=yes
RestrictNamespaces=yes
LockPersonality=yes
MemoryDenyWriteExecute=yes
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX
RestrictSUIDSGID=yes
RemoveIPC=yes
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫ –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–∞–º—è—Ç—å, CPU)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∞—Ç–∞–∫—É–µ–º–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏

---

### ‚ö†Ô∏è 4. DNS –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–ø—É—â–µ–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∞:**
- –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ dnsmasq/unbound
- DoH/DoT —É–∂–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ö–æ—Ä–æ—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:
- ‚úÖ Xray —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –ø–æ—Ä—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã (10003, 10004, 10006, 10007, 10008)
- ‚úÖ Memory limit: 512M (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞)

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:
- **–î–æ:** 85% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- **–ü–æ—Å–ª–µ:** 95%+ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å ‚úÖ
- **–ü—Ä–∏—Ä–æ—Å—Ç:** +10-15%

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- **–î–æ:** 80% –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ü–æ—Å–ª–µ:** 90%+ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚úÖ
- **–ü—Ä–∏—Ä–æ—Å—Ç:** +10%

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `/root/vpn-server/config/config.json` - Policy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `/etc/sysctl.conf` - TCP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `/etc/systemd/system/xray.service` - Systemd hardening

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
sudo sysctl -p                    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å TCP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
sudo systemctl daemon-reload      # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd
sudo systemctl restart xray      # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Xray
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
sudo systemctl status xray
ss -tuln | grep -E "10001|10003|10004|10006|10007|10008"
sysctl net.ipv4.tcp_keepalive_time
```

---

## ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
1. ‚úÖ Policy –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ Xray
2. ‚úÖ TCP –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
3. ‚úÖ Systemd hardening –ø—Ä–∏–º–µ–Ω–µ–Ω
4. ‚ö†Ô∏è DNS –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:
- ‚ùå –ö–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚ùå URL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π - –ø—Ä–µ–∂–Ω–∏–µ
- ‚ùå –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - —É–ª—É—á—à–µ–Ω–∞ (–Ω–µ —É—Ö—É–¥—à–µ–Ω–∞)

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è:
- ‚ùå –ü–µ—Ä–µ–≤—ã–ø—É—Å–∫–∞—Ç—å –∫–ª—é—á–∏
- ‚ùå –ú–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚ùå –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ —á–µ–º-–ª–∏–±–æ

---

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ | –ü–æ—Å–ª–µ |
|----------|-----|--------|
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** | 85% | 95%+ ‚úÖ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞** | 80% | 90%+ ‚úÖ |
| **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö** | –ë–∞–∑–æ–≤–∞—è | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è ‚úÖ |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏** | –ë–∞–∑–æ–≤–æ–µ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫** | –ë–∞–∑–æ–≤–∞—è | –£–ª—É—á—à–µ–Ω–Ω–∞—è ‚úÖ |

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:

- ‚úÖ **Policy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ **TCP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –ª—É—á—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
- ‚úÖ **Systemd hardening** - –≤—ã—à–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞–º—è—Ç–∏/CPU

**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

**–ü–µ—Ä–µ–≤—ã–ø—É—Å–∫ –∫–ª—é—á–µ–π:** –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–û–ï (+5-10%)

