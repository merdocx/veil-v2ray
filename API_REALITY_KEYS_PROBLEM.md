# üö® –ü–†–û–ë–õ–ï–ú–ê –° REALITY –ö–õ–Æ–ß–ê–ú–ò –í API

## üîç **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ VPN –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ API –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞ —Å Reality –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

1. **API –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ Reality –∫–ª—é—á–∏** –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑ `keys.env`
2. **Short ID –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
3. **–ö–ª—é—á–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç** –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è Reality –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üîß **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**

### –ü—Ä–æ–±–ª–µ–º–∞ –≤ `xray_config_manager.py`:

```python
def create_inbound_for_key(self, uuid: str, key_name: str) -> Optional[Dict]:
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ Reality –∫–ª—é—á–∏
    reality_keys = self._load_reality_keys()
    if not reality_keys.get('private_key') or not reality_keys.get('short_id'):
        print("Error: Centralized Reality keys not found")
        return None
    
    # –°–æ–∑–¥–∞–µ–º inbound –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
    inbound = {
        # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...
        "realitySettings": {
            "privateKey": reality_keys['private_key'],  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
            "shortIds": [reality_keys['short_id']],    # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
        }
    }
```

**–ù–û!** API –≤—Å–µ —Ä–∞–≤–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –∫–ª—é—á–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ.

## üéØ **–†–µ—à–µ–Ω–∏–µ**

### 1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø—Ä–∞–≤–∏—Ç—å Reality –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python3 -c "
import json
with open('config/config.json', 'r') as f:
    config = json.load(f)

for inbound in config['inbounds']:
    if inbound.get('port') == 10003 and 'streamSettings' in inbound:
        reality = inbound['streamSettings']['realitySettings']
        reality['privateKey'] = 'INDgW1I7I-ZmXvEg6pnQR15AfuHT4JlxzIouqIJ5kVs'
        reality['shortIds'] = ['2680beb40ea2fde0']

with open('config/config.json', 'w') as f:
    json.dump(config, f, indent=2)
"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Xray
systemctl restart xray
```

### 2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á:**
```
vless://f4d74bb8-2a5a-45a7-9c44-9e1025ffb60b@146.103.100.14:10003?type=tcp&security=reality&sni=www.microsoft.com&pbk=eeA7CJSPNzlYKqXAsRfFNwtcpG2wXOtgDLPqaXBV13c&sid=2680beb40ea2fde0&fp=chrome#nvipetrenko@gmail.com
```

## üõ†Ô∏è **–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –≤ –±—É–¥—É—â–µ–º**

### 1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å API –∫–æ–¥:**

–í `api.py` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `create_key`:

```python
# –í–º–µ—Å—Ç–æ:
if not add_key_to_xray_config(key_uuid, request.name):

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
if not add_key_to_xray_config_with_centralized_keys(key_uuid, request.name):
```

### 2. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:**

```python
def add_key_to_xray_config_with_centralized_keys(uuid: str, key_name: str) -> bool:
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π"""
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏
    reality_keys = load_reality_keys_from_env()
    
    # –°–æ–∑–¥–∞–µ–º inbound —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
    inbound = create_inbound_with_centralized_keys(uuid, reality_keys)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    return add_inbound_to_config(inbound)
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞:**

```python
def validate_key_after_creation(uuid: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ Reality –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Reality –∫–ª—é—á–∏
    # –ï—Å–ª–∏ –Ω–µ—Ç - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    pass
```

## üìã **–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è**

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Reality –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞
- [ ] **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π** –∏–∑ `keys.env`
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Short ID** –º–µ–∂–¥—É –∫–ª—é—á–æ–º –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- [ ] **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Xray** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á** –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Reality –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
grep -A 5 -B 5 "privateKey" config/config.json

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Short ID
grep -A 5 -B 5 "shortIds" config/config.json

# –°—Ä–∞–≤–Ω–∏—Ç—å —Å keys.env
cat config/keys.env
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
/usr/local/bin/xray x25519 -i <private_key>

# –°—Ä–∞–≤–Ω–∏—Ç—å —Å –∫–ª—é—á–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## üéØ **–ò—Ç–æ–≥**

**–ü—Ä–æ–±–ª–µ–º–∞:** API –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ Reality –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ `keys.env` –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞.

**–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é Reality –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ API –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏.

