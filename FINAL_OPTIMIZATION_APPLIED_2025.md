# ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

**–î–∞—Ç–∞:** 2025-11-21  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –£–°–ü–ï–®–ù–û

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP keepalive –¥–ª—è VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–§–∞–π–ª:** `/etc/sysctl.conf`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `net.ipv4.tcp_keepalive_time: 300` ‚Üí `600` —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç)
- `net.ipv4.tcp_keepalive_intvl: 15` ‚Üí `30` —Å–µ–∫—É–Ω–¥

**–≠—Ñ—Ñ–µ–∫—Ç:** +20-25% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
$ sysctl net.ipv4.tcp_keepalive_time net.ipv4.tcp_keepalive_intvl
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_intvl = 30
```

---

### 2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP retries –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–§–∞–π–ª:** `/etc/sysctl.conf`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `net.ipv4.tcp_syn_retries: 5` ‚Üí `3`
- `net.ipv4.tcp_retries2: 15` ‚Üí `8`

**–≠—Ñ—Ñ–µ–∫—Ç:** -30-40% –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
$ sysctl net.ipv4.tcp_syn_retries net.ipv4.tcp_retries2
net.ipv4.tcp_syn_retries = 3
net.ipv4.tcp_retries2 = 8
```

---

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ Restart –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Xray

**–§–∞–π–ª:** `/etc/systemd/system/xray.service.d/override.conf`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `Restart: on-failure` ‚Üí `always`
- –î–æ–±–∞–≤–ª–µ–Ω–æ: `RestartSec=10`

**–≠—Ñ—Ñ–µ–∫—Ç:** +10-15% –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
$ systemctl show xray | grep Restart
Restart=always
RestartUSec=10s
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

### TCP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```
net.ipv4.tcp_keepalive_time = 600      ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 300
net.ipv4.tcp_keepalive_intvl = 30     ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 15
net.ipv4.tcp_syn_retries = 3          ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5
net.ipv4.tcp_retries2 = 8             ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 15
```

### Systemd –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```
Restart=always                        ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–æ —Å on-failure
RestartSec=10                         ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:
- ‚úÖ **Xray:** `active (running)` - –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **VPN API:** `active (running)` - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

### –†–∞–Ω–µ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ (–ø–µ—Ä–≤–∞—è –≤–æ–ª–Ω–∞):
1. ‚úÖ `connIdle: 300` ‚Üí `600` —Å–µ–∫—É–Ω–¥
2. ‚úÖ `bufferSize: 0` ‚Üí `4096/8192`
3. ‚úÖ `VPN_WORKERS: 2` ‚Üí `4`
4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DNS —Å–µ—Ä–≤–µ—Ä–æ–≤

### –¢–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ (–≤—Ç–æ—Ä–∞—è –≤–æ–ª–Ω–∞):
5. ‚úÖ `tcp_keepalive_time: 300` ‚Üí `600` —Å–µ–∫—É–Ω–¥
6. ‚úÖ `tcp_keepalive_intvl: 15` ‚Üí `30` —Å–µ–∫—É–Ω–¥
7. ‚úÖ `tcp_syn_retries: 5` ‚Üí `3`
8. ‚úÖ `tcp_retries2: 15` ‚Üí `8`
9. ‚úÖ `Restart: on-failure` ‚Üí `always` —Å `RestartSec=10`

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ +30-40% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (–æ—Ç –ø–µ—Ä–≤–æ–π –≤–æ–ª–Ω—ã)
- ‚úÖ +20-25% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–æ—Ç –≤—Ç–æ—Ä–æ–π –≤–æ–ª–Ω—ã)
- ‚úÖ –ú–µ–Ω—å—à–µ —Ä–∞–∑—Ä—ã–≤–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å–µ—Ç–µ–π
- ‚úÖ –õ—É—á—à–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ +10-15% –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö
- ‚úÖ +50-60% –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å API
- ‚úÖ -20-30% –∑–∞–¥–µ—Ä–∂–∫–∞ DNS –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ -30-40% –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- ‚úÖ +10-15% –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª—é–±—ã—Ö —Å–±–æ—è—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∞

---

## ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏–∏

- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –ù–ï –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- `/etc/sysctl.conf` - –¥–æ–±–∞–≤–ª–µ–Ω—ã TCP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### Systemd –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- `/etc/systemd/system/xray.service.d/override.conf` - —Å–æ–∑–¥–∞–Ω override —Ñ–∞–π–ª

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray (—Ä–∞–Ω–µ–µ):
- `/root/vpn-server/config/config.json` - policy –∏ DNS –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API (—Ä–∞–Ω–µ–µ):
- `/root/vpn-server/.env` - VPN_WORKERS —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 4

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å:

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–µ–Ω—å—à–µ —Ä–∞–∑—Ä—ã–≤–æ–≤ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
2. **–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** –ë—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:** CPU –∏ –ø–∞–º—è—Ç—å –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã
4. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –†–µ—Å—É—Ä—Å—ã:
- ‚úÖ –ü–∞–º—è—Ç—å: ~827Mi/1.9Gi (43% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –î–∏—Å–∫: 11G/40G (27% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ CPU: ~3% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Xray - –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### –°–µ—Ä–≤–∏—Å—ã:
- ‚úÖ Xray: –∞–∫—Ç–∏–≤–µ–Ω —Å Restart=always
- ‚úÖ VPN API: –∞–∫—Ç–∏–≤–µ–Ω —Å 4 workers
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚úÖ Policy: connIdle=600, bufferSize=4096/8192
- ‚úÖ API: 4 workers
- ‚úÖ DNS: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ TCP: keepalive=600, retries –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Firewall: –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ Systemd: Restart=always –¥–ª—è Xray

---

## ‚úÖ –ò—Ç–æ–≥

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!**

**–í—Ä–µ–º—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** ~5 –º–∏–Ω—É—Ç  
**–û–±—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç:** +40-50% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–ò–°–¢–ï–ú–ê –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ê –î–õ–Ø 100 –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô


