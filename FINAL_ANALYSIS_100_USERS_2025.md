# üîç –§–∏–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ VPN —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-11-21  
**–¶–µ–ª–µ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –¥–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∫–ª—é—á–µ–π  
**–§–æ–∫—É—Å:** –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

---

## ‚úÖ –£–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Policy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ `connIdle: 600` —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç) - —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 300
- ‚úÖ `bufferSize: 4096/8192` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ `handshake: 4/8` - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### 2. API –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ `VPN_WORKERS: 4` - —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 2
- ‚úÖ –õ–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏ –∏ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 3. DNS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö DNS —Å–µ—Ä–≤–µ—Ä–æ–≤ (1.1.1.1, 1.0.0.1, 8.8.8.8)
- ‚úÖ –£–±—Ä–∞–Ω—ã DoH/DoT –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏

### 4. –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ TCP –±—É—Ñ–µ—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (rmem_max/wmem_max = 33554432)
- ‚úÖ Connection tracking —É–≤–µ–ª–∏—á–µ–Ω (nf_conntrack_max = 2000000)
- ‚úÖ TCP backlog —É–≤–µ–ª–∏—á–µ–Ω (somaxconn = 8192, tcp_max_syn_backlog = 16384)

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–´–ï —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP keepalive –¥–ª—è VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:** `tcp_keepalive_time = 300` (5 –º–∏–Ω—É—Ç) —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –¥–ª—è VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –ü—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç —Ä–∞–∑—Ä—ã–≤–∞—Ç—å—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º Xray —É—Å–ø–µ–µ—Ç –∏—Ö –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å TCP keepalive –≤—Ä–µ–º—è –¥–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

**–§–∞–π–ª:** `/etc/sysctl.conf` (–¥–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å):

```bash
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP keepalive –¥–ª—è VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
net.ipv4.tcp_keepalive_time = 600        # –ë—ã–ª–æ: 300, –°—Ç–∞–ª–æ: 600 (10 –º–∏–Ω—É—Ç)
net.ipv4.tcp_keepalive_intvl = 30        # –ë—ã–ª–æ: 15, –°—Ç–∞–ª–æ: 30 (30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
net.ipv4.tcp_keepalive_probes = 5         # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (5 –ø–æ–ø—ã—Ç–æ–∫)
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
sudo sysctl -w net.ipv4.tcp_keepalive_time=600
sudo sysctl -w net.ipv4.tcp_keepalive_intvl=30
sudo sysctl -p
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ +20-25% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –ú–µ–Ω—å—à–µ —Ä–∞–∑—Ä—ã–≤–æ–≤ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
- ‚úÖ –õ—É—á—à–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ

**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

---

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP retries –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ ‚≠ê‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `tcp_syn_retries = 5` –∏ `tcp_retries2 = 15` –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º–∏ –¥–ª—è VPN, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é.

**–†–µ—à–µ–Ω–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é.

**–§–∞–π–ª:** `/etc/sysctl.conf` (–¥–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å):

```bash
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP retries –¥–ª—è VPN
net.ipv4.tcp_syn_retries = 3              # –ë—ã–ª–æ: 5, –°—Ç–∞–ª–æ: 3 (–±—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º)
net.ipv4.tcp_synack_retries = 2           # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
net.ipv4.tcp_retries2 = 8                 # –ë—ã–ª–æ: 15, –°—Ç–∞–ª–æ: 8 (–±–∞–ª–∞–Ω—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏)
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
sudo sysctl -w net.ipv4.tcp_syn_retries=3
sudo sysctl -w net.ipv4.tcp_retries2=8
sudo sysctl -p
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ -30-40% –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö

**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤)

---

## üü° –í–ê–ñ–ù–´–ï —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)

### 3. –£–ª—É—á—à–µ–Ω–∏–µ Restart –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Xray ‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:** `Restart=on-failure` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Xray –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `Restart=always` —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

**–§–∞–π–ª:** `/etc/systemd/system/xray.service`

**–¢–µ–∫—É—â–µ–µ:**
```ini
Restart=on-failure
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ:**
```ini
Restart=always
RestartSec=10
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª—é–±—ã—Ö —Å–±–æ—è—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ +10-15% –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ü–∏–∫–ª—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ –ª—É—á—à–µ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å)

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
sudo systemctl edit xray
# –î–æ–±–∞–≤–∏—Ç—å:
[Service]
Restart=always
RestartSec=10
sudo systemctl daemon-reload
sudo systemctl restart xray
```

---

## ‚úÖ –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å (—É–∂–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

- ‚ùå **SQLite –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - WAL —Ä–µ–∂–∏–º –∏ NORMAL synchronous –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã
- ‚ùå **Systemd –ª–∏–º–∏—Ç—ã** - LimitNOFILE=1000000, MemoryMax=1G –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã
- ‚ùå **Firewall –ø—Ä–∞–≤–∏–ª–∞** - —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç DDoS
- ‚ùå **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã, –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
- ‚ùå **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - logrotate –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ùå **Reality –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - maxTimeDiff: 600 –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
- ‚ùå **DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚ùå **Policy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (—Å–¥–µ–ª–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
1. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP keepalive** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP retries** - –≤–∞–∂–Ω–æ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** ~5 –º–∏–Ω—É—Ç  
**–≠—Ñ—Ñ–µ–∫—Ç:** +20-25% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –í–∞–∂–Ω—ã–µ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
3. ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ Restart –ø–æ–ª–∏—Ç–∏–∫–∏** - –ø–æ–≤—ã—Å–∏—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** ~2 –º–∏–Ω—É—Ç—ã  
**–≠—Ñ—Ñ–µ–∫—Ç:** +10-15% –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
1. –£–≤–µ–ª–∏—á–∏—Ç—å `tcp_keepalive_time` –¥–æ 600
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `tcp_syn_retries` –∏ `tcp_retries2`

**–ò—Ç–æ–≥–æ:** ~5 –º–∏–Ω—É—Ç  
**–≠—Ñ—Ñ–µ–∫—Ç:** +20-25% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –Ω–∞–±–æ—Ä:
1-2. –í—Å–µ –∏–∑ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞
3. –ò–∑–º–µ–Ω–∏—Ç—å `Restart=always` –¥–ª—è Xray

**–ò—Ç–æ–≥–æ:** ~7 –º–∏–Ω—É—Ç  
**–≠—Ñ—Ñ–µ–∫—Ç:** +30-35% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

---

## üìù –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –®–∞–≥ 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP keepalive
```bash
sudo sysctl -w net.ipv4.tcp_keepalive_time=600
sudo sysctl -w net.ipv4.tcp_keepalive_intvl=30
echo "net.ipv4.tcp_keepalive_time = 600" | sudo tee -a /etc/sysctl.conf
echo "net.ipv4.tcp_keepalive_intvl = 30" | sudo tee -a /etc/sysctl.conf
```

### –®–∞–≥ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP retries
```bash
sudo sysctl -w net.ipv4.tcp_syn_retries=3
sudo sysctl -w net.ipv4.tcp_retries2=8
echo "net.ipv4.tcp_syn_retries = 3" | sudo tee -a /etc/sysctl.conf
echo "net.ipv4.tcp_retries2 = 8" | sudo tee -a /etc/sysctl.conf
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
sudo sysctl -p
```

### –®–∞–≥ 4 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –£–ª—É—á—à–µ–Ω–∏–µ Restart –ø–æ–ª–∏—Ç–∏–∫–∏
```bash
sudo systemctl edit xray
# –î–æ–±–∞–≤–∏—Ç—å:
[Service]
Restart=always
RestartSec=10

sudo systemctl daemon-reload
sudo systemctl restart xray
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TCP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
sysctl net.ipv4.tcp_keepalive_time net.ipv4.tcp_keepalive_intvl net.ipv4.tcp_syn_retries net.ipv4.tcp_retries2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status xray vpn-api
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å:

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:** –ú–µ–Ω—å—à–µ —Ä–∞–∑—Ä—ã–≤–æ–≤ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
2. **–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** –ë—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:** CPU –∏ –ø–∞–º—è—Ç—å –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã

---

## ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏–∏

- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –ù–ï –∏–∑–º–µ–Ω—è—é—Ç—Å—è
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ú–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –†–µ—Å—É—Ä—Å—ã:
- ‚úÖ –ü–∞–º—è—Ç—å: 827Mi/1.9Gi (43% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –î–∏—Å–∫: 11G/40G (27% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ CPU: ~3% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Xray - –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### –°–µ—Ä–≤–∏—Å—ã:
- ‚úÖ Xray: –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ VPN API: –∞–∫—Ç–∏–≤–µ–Ω —Å 4 workers
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚úÖ Policy: connIdle=600, bufferSize=4096/8192
- ‚úÖ API: 4 workers
- ‚úÖ DNS: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Firewall: –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ 2-3 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞.

