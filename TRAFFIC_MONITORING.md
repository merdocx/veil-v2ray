# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ VPN –∫–ª—é—á–µ–π

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ—Å—Ç–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è VPN –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ Xray. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –¥–æ–º–µ–Ω—ã, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª—é—á–∞.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`log_parser.py`** - –ú–æ–¥—É–ª—å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–æ–≤ Xray
- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - REST API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:
- **–§–∞–π–ª –ª–æ–≥–æ–≤**: `/root/vpn-server/logs/access.log`
- **–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤**: `2025/08/02 14:00:44 192.168.1.100:12345 accepted tcp:google.com:443 [direct]`

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞:
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** - –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- **–ü—Ä–∏–Ω—è—Ç—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** - —É—Å–ø–µ—à–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** - –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∞–π—Ç–æ–≤
- **–°–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤** - –≤—Å–µ –ø–æ—Å–µ—â–µ–Ω–Ω—ã–µ —Å–∞–π—Ç—ã
- **–ü—Ä–æ—Ç–æ–∫–æ–ª—ã** - TCP/UDP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** - –ø–µ—Ä–≤–æ–µ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **–í—Å–µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** –ø–æ –≤—Å–µ–º –∫–ª—é—á–∞–º
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ IP** –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã** –ø–æ –≤—Å–µ–º –∫–ª—é—á–∞–º
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤** (TCP/UDP)

## üîå API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –û–±—â–∞—è —Å–≤–æ–¥–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
```bash
GET /api/traffic/summary?hours=24
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_connections": 505,
  "accepted_connections": 505,
  "rejected_connections": 0,
  "unique_ips": 1,
  "unique_domains": 120,
  "protocols": {
    "tcp": 387,
    "udp": 118
  },
  "period_hours": 24,
  "total_keys": 1,
  "active_keys": 1
}
```

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
```bash
GET /api/keys/{key_id}/traffic?hours=24
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "key": {
    "id": "key-id",
    "name": "Key Name",
    "uuid": "uuid",
    "created_at": "2025-08-02T14:00:44",
    "is_active": true
  },
  "connection_stats": {
    "uuid": "uuid",
    "period_hours": 24,
    "total_connections": 505,
    "accepted_connections": 505,
    "rejected_connections": 0,
    "unique_domains": 120,
    "domains": ["google.com", "youtube.com"],
    "protocols": {
      "tcp": 387,
      "udp": 118
    },
    "last_connection": "2025-08-02T14:40:04",
    "first_connection": "2025-08-02T13:41:17"
  }
}
```

### 3. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
```bash
GET /api/traffic
```

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç `manage.sh`:

```bash
# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
./manage.sh traffic

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
./manage.sh traffic-key <key_id>

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞—Å–æ–≤)
./manage.sh traffic-key <key_id> <hours>

# –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
./manage.sh all-traffic
```

### –ü—Ä–∏–º–µ—Ä—ã:
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
./manage.sh traffic-key 0d3b88ab-f0f3-4ed4-92bc-bb20071bd89e 1

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π (168 —á–∞—Å–æ–≤)
./manage.sh traffic-key 0d3b88ab-f0f3-4ed4-92bc-bb20071bd89e 168
```

## üìä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- ‚ùå **–ù–µ—Ç —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ –±–∞–π—Ç** - —Ç–æ–ª—å–∫–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚ùå **–ù–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ IP –∫ –∫–ª—é—á—É** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—â–∞—è –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π
- ‚ùå **–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏** - –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- ‚ùå **–ù–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—á–∏** - —Ç–æ–ª—å–∫–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Xray API** - –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ –±–∞–π—Ç
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ **–ü—Ä–∏–≤—è–∑–∫–∞ IP –∫ –∫–ª—é—á—É** - —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
- ‚úÖ **–ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∞—à–±–æ—Ä–¥** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤:
```python
# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
pattern = r'(\d{4}/\d{2}/\d{2} \d{2}:\d{2}:\d{2}) (\d+\.\d+\.\d+\.\d+):(\d+) (\w+) (\w+):([^:]+):(\d+) \[(\w+)\]'
```

### –ü–µ—Ä–∏–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞:
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: 24 —á–∞—Å–∞
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π**: –æ—Ç 1 —á–∞—Å–∞ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–Ω–µ–π
- **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è**: –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥** - —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
```bash
curl -s http://veil-bird.ru/api/traffic/summary | python3 -m json.tool
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª—é—á–∞:
```bash
curl -s "http://veil-bird.ru/api/keys/{key_id}/traffic?hours=24" | python3 -m json.tool
```

### 3. –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```bash
./manage.sh traffic
./manage.sh traffic-key <key_id>
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞ Xray
- –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Xray API
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ 